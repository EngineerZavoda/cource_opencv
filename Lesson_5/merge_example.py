import cv2  # Импортируем OpenCV для работы с изображениями

# 1. Загрузка изображения  # Шаг 1: читаем изображение с диска
image = cv2.imread('/Users/pvs/Desktop/Программы/cv_ai/Lesson_5/circle.png')  # Путь к файлу
original = image.copy()  # Создаем копию, чтобы рисовать поверх

# 2. Преобразование в оттенки серого  # Шаг 2: переводим в градации серого
gray = cv2.cvtColor(image,  # Входное изображение в BGR
                    cv2.COLOR_BGR2GRAY)  # Флаг конвертации BGR -> Gray

# 3. Применение размытия для удаления шума  # Шаг 3: сглаживаем шум
blurred = cv2.GaussianBlur(gray,  # Размываем серое изображение
                           (5, 5),  # Размер ядра размытия
                           0)  # Сигма по умолчанию

# 4. Бинаризация изображения  # Шаг 4: делаем маску черно-белой
_, binary = cv2.threshold(blurred,  # Входное размытое изображение
                          150,  # Порог яркости
                          250,  # Значение белого
                          cv2.THRESH_BINARY_INV)  # Тип порога: бинарный

# 5. Поиск контуров  # Шаг 5: извлекаем контуры из маски
contours, hierarchy = cv2.findContours(  # Находим контуры и иерархию
    binary,  # Бинарное изображение
    cv2.RETR_EXTERNAL,  # Только внешние контуры
    cv2.CHAIN_APPROX_SIMPLE  # Упрощение точек контура
)

# 6. Отрисовка контуров на оригинале  # Шаг 6: рисуем контуры поверх копии
cv2.drawContours(original,  # Изображение, на котором рисуем
                 contours,  # Список найденных контуров
                 -1,  # Индекс -1 означает все контуры
                 (0, 255, 0),  # Цвет линии в формате BGR (зеленый)
                 2)  # Толщина линии в пикселях

# 7. Вывод результата  # Шаг 7: выводим информацию и окно результата
print(f'Найдено контуров: {len(contours)}')  # Количество контуров в списке
cv2.imshow('Contours', original)  # Показ окна с изображением
cv2.imshow(" ", binary)
cv2.waitKey(0)  # Ждем клавишу, чтобы окно не закрывалось
